"use strict";function resfreshJSTree(){setTimeout((function(){$("#evts").jstree(!0).refresh()}),500)}if($(".main-body .page-wrapper").find("#category-info-container").length){var selectedNodeId="",selectedNodeName="",editId="";function resetForm(){$("#status").val("Active").trigger("change"),$("#is_searchable").val(1).trigger("change"),$("#edit_id").val(null),$(".custom-file-label").text("Upload image"),$(".img-remove-icon").trigger("click"),$("#imageBlock").hide(),$("#note_txt_2").hide(),document.getElementById("categoryFrom").reset()}function getInfo(categoryId,createChild,type="edit"){$("#imageBlock").show(),$(".cursor_pointer > img").remove(),$(".sub-category").is(":disabled")&&1==createChild?$(".sub-category").prop("disabled",!1):$(".sub-category").is(":disabled")||0!=createChild||$(".sub-category").prop("disabled",!0),editId=categoryId,$.ajax({url:SITE_URL+"/categories/edit",type:"POST",data:{_token:token,id:categoryId,create_child:createChild},dataType:"json",success:function(data){$("input").each((function(){this.setCustomValidity("")})),$("#name").val(data.name).siblings(".error").remove(),$("#slug").val(data.slug).siblings(".error").remove(),$("#status").val(data.status).trigger("change"),$("#is_searchable").val(data.is_searchable).trigger("change"),$("#is_featured").val(data.is_featured).trigger("change"),$("#sell_commissions").val(getDecimalNumberFormat(data.sell_commissions)),$("#edit_id").val(editId),$(".cursor_pointer").empty(),$(".cursor_pointer").append('<img class="profile-user-img img-responsive fixSize neg-transition-scale" src="'+data.image_path+'" alt="" class="img-thumbnail attachment-styles"/>'),null!=data.parent_id?($("#parentBlock").show(),$('select[name="parent_id"]').empty(),$('select[name="parent_id"]').append('<option value="'+data.parent_id+'">'+data.parent_name+"</option>")):($('select[name="parent_id"]').empty(),$("#parentBlock").hide())}})}function doMoveNode(id,parent,oldParent,position,oldPosition){let url,formData;clickOnSave("/categories/move-node","POST",{id:id,parent:parent,old_parent:oldParent,position:position,old_position:oldPosition}),resetForm(),resfreshJSTree()}$(".sub-category").prop("disabled",!0),$("#parentBlock").hide(),$(".delete").hide(),$("#imageBlock").hide(),$(document).on("keyup","#name",(function(){var str=this.value.replace(/[&\/\\#@,+()$~%.'":*?<>{}]/g,"");$("#slug").val(str.trim().toLowerCase().replace(/\s/g,"-"))})),$(document).on("keyup","#slug",(function(){var str=this.value.replace(/[&\/\\#@,+()$~%.'":*?<>{}]/g,"");$("#slug").val(str.trim().toLowerCase().replace(/\s/g,"-"))})),$("#categoryFrom").on("submit",(function(event){event.preventDefault();let url="",formData=new FormData(this);"store"==$("#type").val()?url="/categories/store":"edit"==$("#type").val()&&(url="/categories/update"),clickOnSaveForm(url,"POST",formData),resetForm(),resfreshJSTree()})),$("#validatedCustomFile").on("change",(function(){for(var files=[],i=0;i<$(this)[0].files.length;i++)files.push($(this)[0].files[i].name);$(this).next(".custom-file-label").html(files.join(", "));var file,fileType=this.files[0].type,validImageTypes=["image/jpg","image/jpeg","image/png"];return $.inArray(fileType,validImageTypes)<0?($("#divNote").show(),$("#note_txt_1").hide(),$("#note_txt_2").html('<h6> <span class="text-danger font-weight-bolder">'+jsLang("Invalid file extension")+'</span> </h6> <span class="badge badge-danger">'+jsLang("Note")+"!</span> "+jsLang("Allowed File Extensions: jpg, png, gif, bmp")),$("#note_txt_2").show(),$("#prvw").hide(),!1):($("#prvw").show(),$("#note_txt_2, #note_txt_1").hide(),!0)})),$(".sub-category").on("click",(function(){resetForm(),$("#parentBlock").show(),$('select[name="parent_id"]').empty(),$('select[name="parent_id"]').append('<option value="'+selectedNodeId+'">'+selectedNodeName+"</option>"),$("#type").val("store"),$(".delete").hide()})),$(".root-category").on("click",(function(){var instance;$("#evts").jstree(!0).deselect_all(),$("#parentBlock").hide(),resetForm(),$("#type").val("store"),$(".delete").hide()})),$(".delete").on("click",(function(){confirmDeleteAjax("/categories/delete","POST",selectedNodeId,"resfreshJSTree"),$(".sub-category").prop("disabled",!0),resetForm()})),$("#evts_button").on("click",(function(){var instance=$("#evts").jstree(!0);instance.deselect_all(),instance.select_node("1")})),$("#evts").on("changed.jstree",(function(e,data){data.selected.length&&($("#type").val("edit"),$(".delete").show(),selectedNodeId=data.instance.get_node(data.selected[0]).id,selectedNodeName=data.instance.get_node(data.selected[0]).text,getInfo(selectedNodeId,data.instance.get_node(data.selected[0]).original.create_child))})).on("move_node.jstree",(function(e,data){data.node.parents.length<4?doMoveNode(data.node.id,data.parent,data.old_parent,data.position,data.old_position):(swal(jsLang("Not Permitted"),{icon:"error",buttons:[!1,jsLang("Ok")]}),resfreshJSTree())})).jstree({core:{check_callback:!0,data:{url:SITE_URL+"/categories/get-data",dataType:"json"}},plugins:["dnd"]})}